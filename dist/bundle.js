!function(e){var r={};function n(t){if(r[t])return r[t].exports;var o=r[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=r,n.d=function(e,r,t){n.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,r){if(1&r&&(e=n(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(n.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)n.d(t,o,function(r){return e[r]}.bind(null,o));return t},n.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(r,"a",r),r},n.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},n.p="/",n(n.s=8)}([function(e,r){e.exports=require("graphql")},function(e,r){e.exports=require("loggy")},function(e,r){e.exports=require("mongoose")},function(e,r){e.exports=require("dotenv/config")},function(e,r){e.exports=require("express")},function(e,r){e.exports=require("cors")},function(e,r){e.exports=require("express-graphql")},function(e,r){e.exports=require("graphql-iso-date")},function(e,r,n){"use strict";n.r(r);n(3);var t={user:process.env.MONGODB_USER,pass:process.env.MONGODB_PASSWORD,useNewUrlParser:!0,useUnifiedTopology:!0,useCreateIndex:!0,useFindAndModify:!1,autoIndex:!1,reconnectTries:Number.MAX_VALUE,reconnectInterval:500,poolSize:10,bufferMaxEntries:0,connectTimeoutMS:1e4,socketTimeoutMS:45e3,family:4},o=n(4),i=n.n(o),a=n(5),s=n.n(a),p=n(1),c=n.n(p),u=n(6),f=n.n(u),l=n(2),d=n.n(l),h=n(0),y=n(7),g=d.a.model("User",new d.a.Schema({name:String,age:Number,profession:String})),b=d.a.model("Post",new d.a.Schema({comment:String,userId:String,creation:Date})),L=d.a.model("Hobby",new d.a.Schema({title:String,description:String,userId:String})),G=(new h.GraphQLObjectType({name:"Person",description:"Represents a person type",fields:function(){return{id:{type:h.GraphQLID},firstName:{type:new h.GraphQLNonNull(h.GraphQLString)},lastName:{type:h.GraphQLString},isMarried:{type:h.GraphQLBoolean}}}}),new h.GraphQLObjectType({name:"Hobby",description:"What a pleasure to have a great hobby in life",fields:function(){return{id:{type:h.GraphQLID,description:"The type of the hobby"},title:{type:new h.GraphQLNonNull(h.GraphQLString),description:"The hobby's title"},description:{type:h.GraphQLString,description:"The hobby's description"},user:{type:v,resolve:function(e){return g.findById(e.userId)}}}}})),m=new h.GraphQLObjectType({name:"Post",description:"This is a post the we can share between users",fields:function(){return{id:{type:h.GraphQLID,description:"The type of post'id"},comment:{type:new h.GraphQLNonNull(h.GraphQLString),description:"The core content of the post"},creation:{type:new h.GraphQLNonNull(y.GraphQLDateTime),description:"The date and time of post creation"},user:{type:v,resolve:function(e){return g.findById(e.userId)}}}}}),v=new h.GraphQLObjectType({name:"User",description:"Description of a User",fields:function(){return{id:{type:h.GraphQLID,description:"User's id"},name:{type:new h.GraphQLNonNull(h.GraphQLString),description:"The name of the user. Can't be null"},age:{type:h.GraphQLInt,description:"Yes, it is actually the age of te user !"},profession:{type:new h.GraphQLNonNull(h.GraphQLString)},posts:{type:new h.GraphQLList(m),resolve:function(e){return c.a.info("Looking for posts for "+e.id),b.find().where("userId").equals(e.id)}},hobbies:{type:new h.GraphQLList(G),resolve:function(e){return c.a.info("Looking for hobbies for "+e.id),L.find().where("userId").equals(e.id)}}}}});function S(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function O(e){for(var r,n=1;n<arguments.length;n++)r=null==arguments[n]?{}:arguments[n],n%2?S(r,!0).forEach((function(n){Q(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S(r).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}));return e}function Q(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}var w=new h.GraphQLObjectType({name:"RootQueryType",description:"The root query",fields:{user:{type:v,args:{id:{type:h.GraphQLID}},resolve:function(e,r){return g.findById(r.id)}},hobby:{type:G,args:{id:{type:h.GraphQLID}},resolve:function(e,r){return L.findById(r.id)}},post:{type:m,args:{id:{type:h.GraphQLID}},resolve:function(e,r){return b.findById(r.id)}},users:{type:new h.GraphQLList(v),resolve:function(){return c.a.info("Looking for users"),g.find()}},posts:{type:new h.GraphQLList(m),resolve:function(){return c.a.info("Looking for posts"),b.find()}},hobbies:{type:new h.GraphQLList(G),resolve:function(){return c.a.info("Looking for hobbies"),L.find()}}}}),I=new h.GraphQLObjectType({name:"Mutation",fields:{CreateUser:{type:v,args:{name:{type:h.GraphQLString},age:{type:h.GraphQLInt},profession:{type:h.GraphQLString}},resolve:function(e,r){var n=new g(O({},r));return n.save().then((function(){return c.a.log("Created")})).catch((function(e){return c.a.error(e)})),n}},CreatePost:{type:m,args:{comment:{type:h.GraphQLString},userId:{type:h.GraphQLID}},resolve:function(e,r){c.a.log("Post created");var n=new b(O({},r,{creation:new Date}));return n.save().then((function(e){return c.a.log(e)})).catch((function(e){return c.a.error(e)})),n}},CreateHobby:{type:G,args:{title:{type:h.GraphQLString},description:{type:h.GraphQLString},userId:{type:h.GraphQLID}},resolve:function(e,r){c.a.log("Hobby created");var n=new L(O({},r));return n.save().then((function(){return c.a.log("Created")})).catch((function(e){return c.a.error(e)})),n}}}}),N=new h.GraphQLSchema({query:w,mutation:I}),T=i()();T.use(s()()).use("/graphql",f()({graphiql:!0,schema:N})).use((function(e,r,n,t){return c.a.error(e.stack),n.headersSent?t(e):(n.status(500),void n.render("error",{error:e}))})),c.a.info("Starting..."),d.a.connect("mongodb+srv://"+process.env.MONGODB_HOST+"/"+process.env.MONGODB_NAME+"?retryWrites=true&w=majority",t).catch((function(e){c.a.error("Error during mongoDB connection",e)})),d.a.connection.on("open",(function(){c.a.log("Now connected to database ".concat(process.env.MONGODB_NAME," on ").concat(process.env.MONGODB_HOST)),T.listen(4e3,(function(){c.a.info("Server is running on [http://localhost:4000/graphql].")}))}));var D=function(){d.a.connection.close().then((function(){c.a.log("Closing connection to database gently.")}))};process.once("SIGINT",D),process.once("SIGHUP",D),process.once("SIGUSR2",D);r.default=T}]);